# Zswap Benchmarks

## Motivation

Zswap is an optional Linux kernel module for a compressed page cache for swapped
out pages [1]. It has several tunable parameters that operators typically
configure using empirically-motivated heuristics [2][3].

These benchmarks aim to determine which Zswap parameters have the most
significant impact under realistic workloads in memory-constrained environments.
This identification will provide initial targets for improvement.

## Files

`remote_zswap_bench.py`:

- Builds and installs KernMLOps and zswap on a remote machine
- Runs KernMLOps' Redis benchmark in a memory-constrained Docker container with
zswap kprobes enabled to measure runtime of key zswap functions
- Collects data frames generated by `make collect`

`process_dataframes.py`:

- Processes dataframes from all experiments
- Calculates time spent in zswap versus overall experiment time to quantify
zswap impact
- Generates figures using plotly

## References

[1]: https://docs.kernel.org/admin-guide/mm/zswap.html "Zswap - Linux kernel documentation"
[2]: https://www.cs.purdue.edu/homes/csjgwang/CloudNativeDB/WSCMemoryASPLOS19.pdf "Software-Defined Far Memory in Warehouse-Scale Computers"
[3]: https://www.cs.cmu.edu/~dskarlat/publications/tmo_asplos22.pdf "TMO: Transparent Memory Offloading in Datacenters"

## Deprecated Files

The following files collect raw statistics from zswap and `perf`, using a
synthetic benchmark (Linux kernel build inside a memory-constrained cgroup):

- `setup.sh`: Builds Linux kernel inside cgroup and measures with perf
- `remote_runner.py`: Configures zswap on remote machine, runs setup.sh, and
collects various statistics from perf
- `parse_results.py`: Parses experiment results and generates plots with
matplotlib
